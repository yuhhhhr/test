<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panorama + FBX Viewer</title>
  <meta name="theme-color" content="#111827" />
  <style>
    html, body { height: 100%; margin: 0; background:#000; }
    #app { position: fixed; inset: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
    import { FBXLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/FBXLoader.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';

    // ====== YOUR LOCAL FILES ======
    const PANORAMA_IMAGE = './2CFfaIJ.jpeg';  // must exist in repo
    const FBX_MODEL_URL  = './character.fbx'; // must exist in repo

    // ====== CORE SETUP ======
    const container = document.getElementById('app');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
    camera.position.set(0, 1.65, 3.5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(devicePixelRatio);
    renderer.setSize(innerWidth, innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    container.appendChild(renderer.domElement);

    // Lighting
    const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
    hemi.position.set(0, 2, 0);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 1.0);
    dir.position.set(3, 5, 2);
    scene.add(dir);

    // Controls
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enablePan = false;
    controls.enableZoom = false;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.4;

    // ====== PANORAMA ======
    new THREE.TextureLoader().load(PANORAMA_IMAGE, (tex) => {
      tex.mapping = THREE.EquirectangularReflectionMapping;
      tex.colorSpace = THREE.SRGBColorSpace;
      scene.background = tex;
    });

    // ====== FBX MODEL ======
    const loader = new FBXLoader();
    loader.load(FBX_MODEL_URL, (fbx) => {
      fbx.traverse((child) => {
        if (child.isMesh && child.material.map) {
          child.material.map.colorSpace = THREE.SRGBColorSpace;
        }
      });
      const box = new THREE.Box3().setFromObject(fbx);
      const size = new THREE.Vector3();
      box.getSize(size);
      const targetHeight = 1.8;
      const scale = targetHeight / (size.y || 1);
      fbx.scale.setScalar(scale);
      fbx.position.y = - (box.min.y * scale);
      scene.add(fbx);
    });

    // ====== LOOP ======
    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });
  </script>
</body>
</html>
